# Implementation Plan: Modernize Board UI

**Branch**: `007-modernize-board-ui` | **Date**: 2026-01-07
**Input**: Feature specification from `/specs/007-modernize-board-ui/spec.md`

## Summary
Replace the HTML/CSS `FallbackBoard` with a high-performance, visually modern `react-konva` implementation. This involves architecting a layered Canvas component structure (`Stage` -> `Background`, `Grid`, `Pieces`, `Highlights`) to ensure 60fps performance and smooth animations.

## Technical Context
**Language/Version**: TypeScript 5.x
**Primary Dependencies**: `react-konva`, `konva`, `zustand` (for state)
**Storage**: N/A (UI only)
**Testing**: Unit tests for component rendering logic (Vitest), Manual verification for visuals.
**Target Platform**: Web (Canvas API)
**Project Type**: Single Page Application Component
**Performance Goals**: 60fps animations, sub-16ms render time for piece moves.

## Constitution Check
*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*
- **Player Experience**: Directly addresses "Visual Feedback" and "Smooth Experience" principles. (Pass)
- **Performance**: Enforces `konva` usage for hardware-accelerated 2D graphics. (Pass)
- **Incremental**: Can be implemented as a replacement component without breaking core logic. (Pass)

## Project Structure

### Documentation
```text
specs/007-modernize-board-ui/
├── plan.md
├── research.md
├── data-model.md
└── tasks.md
```

### Source Code
```text
src/components/game/
├── board/                  # New directory for board components
│   ├── GameBoard.tsx       # Main Stage container (Replaces current GameBoard.tsx)
│   ├── BackgroundLayer.tsx # Static board texture & grid
│   ├── GridLayer.tsx       # (Optional) Separated grid lines
│   ├── PieceLayer.tsx      # Dynamic pieces
│   ├── HighlightLayer.tsx  # Selection & Move indicators
│   └── constants.ts        # Visual constants (colors, sizes)
```

## Phase 0: Outline & Research
1.  **Unknowns**:
    -   Best way to render "Wood Texture" in Konva without heavy assets? (Procedural or CSS background behind Canvas?)
    -   Handling "Responsive" resizing with Konva `Stage`? (Need a ResizeObserver wrapper).

2.  **Research Tasks**:
    -   [ ] Verify `react-konva` setup in Next.js (SSR issues with Canvas). Need dynamic import?
    -   [ ] Determine optimal way to render high-quality Chinese characters in Konva (Text vs Path).

## Phase 1: Design & Contracts
1.  **Data Model**:
    -   Define `VisualPiece` interface (extending `Piece` with visual state like `isDragging`, `animating`).
2.  **Contracts**:
    -   `GameBoard` props: `width`, `height`, `onMove`.

## Phase 2: Tasks & Implementation
(To be generated by `speckit.tasks`)